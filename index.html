<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>شاومي برو - بدون تحديث تلقائي وحفظ دائم</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* منع السحب لتحديث الصفحة (pull-to-refresh) */
        body {
            overscroll-behavior-y: contain;
            background-color: #1a1a1a; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh;
            overflow: hidden; 
            margin: 0;
            padding: 0;
        }
        @font-face {
            font-family: 'Microsoft Uighur';
            src: local('Microsoft Uighur'), local('Microsoft Uighur Regular'), local('Tahoma'), local('Noto Naskh Arabic');
            font-weight: normal;
            font-style: normal;
        }
        :root {
            --bg-ui: url('https://picsum.photos/seed/girl2026_1/900/1600');
            --system-font: 'Cairo', sans-serif;
            --clock-font: 'Microsoft Uighur', 'Tahoma', 'Noto Naskh Arabic', sans-serif;
            --miui-radius: 22px;
            --phone-width: 100%;
            --phone-height: 100vh;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: var(--system-font); outline: none; }

        .phone-frame {
            width: var(--phone-width);
            height: var(--phone-height);
            max-width: 360px; 
            background: var(--bg-ui) center/cover;
            position: relative;
            overflow: hidden;
            border: none;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
            transition: background-image 0.8s ease-in-out;
            padding-bottom: 80px; 
        }
        @media (max-width: 600px) {
            .phone-frame {
                max-width: 100%;
                box-shadow: none;
            }
        }

        .phone-content {
            height: 100%;
            overflow-y: auto;
            padding-bottom: 20px;
            -webkit-overflow-scrolling: touch;
        }
        .phone-content::-webkit-scrollbar { display: none; }

        /* شريط الحالة */
        .status-bar {
            height: 40px; padding: 0 20px;
            display: flex; justify-content: space-between; align-items: center;
            color: white; z-index: 2000; position: relative;
            margin-top: env(safe-area-inset-top); 
        }

        .status-left { display: flex; align-items: center; }
        .editable-time { 
            cursor: text; 
            font-weight: 400; 
            font-size: 16px;
            letter-spacing: 0.5px; 
            font-family: var(--clock-font);
        }

        .status-right { display: flex; align-items: center; gap: 6px; }

        .network-speed {
            font-size: 9px; font-weight: 600; direction: ltr; display: flex; gap: 1px; opacity: 0.95; cursor: text; margin-left: -5px;
        }

        .signal-container { display: flex; flex-direction: column; align-items: center; position: relative; justify-content: center; line-height: 1; }
        .network-type { font-size: 7px; font-weight: 900; position: absolute; top: -4px; left: 0; transform: translateX(-50%); letter-spacing: -0.2px; }
        .signal-icon { font-size: 10px; }

        .battery-container {
            position: relative; width: 24px; height: 11px; border: 1.2px solid rgba(255, 255, 255, 0.8);
            border-radius: 3px; display: flex; align-items: center; justify-content: center; padding: 1px;
        }
        .battery-container::after { content: ''; position: absolute; right: -3px; top: 3px; width: 2px; height: 4px; background: rgba(255, 255, 255, 0.8); border-radius: 0 1px 1px 0; }
        .battery-level { position: absolute; left: 1px; top: 1px; bottom: 1px; background: #fff; border-radius: 1.5px; z-index: 1; }
        .battery-percentage { position: relative; z-index: 2; font-size: 7px; font-weight: 900; color: #000; line-height: 1; transform: scale(0.9); }

        /* ودجت جوجل */
        .google-widget {
            margin: 15px 15px 8px 15px;
            background: rgba(255, 255, 255, 0.95);
            height: 42px;
            border-radius: 21px;
            display: flex;
            align-items: center;
            padding: 0 14px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .google-logo { width: 18px; margin-left: 10px; }
        .google-search-text { flex: 1; color: #70757a; font-size: 13px; text-align: right; }
        .google-icons { display: flex; gap: 10px; color: #5f6368; font-size: 16px; }

        /* ودجت الساعة والطقس */
        .main-widget-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 25px;
            color: white;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .weather-box { 
            text-align: right; 
            display: flex; 
            flex-direction: column; 
            align-items: flex-end; 
            gap: 1px; 
            font-size: 14px;
            font-weight: 600; 
        }
        .weather-icon { font-size: 26px; color: #ffeb3b; }
        #dateDisplay {                        
            font-family: var(--clock-font);
            font-weight: 400;
            font-size: 16px;
            color: rgba(255,255,255,0.95);
            text-shadow: none;
            margin-top: 0;
        }

        .big-clock-box { text-align: left; }
        .widget-big-time {
            font-family: var(--clock-font);
            font-size: 48px;
            font-weight: 400; 
            line-height: 1.1;
        }

        /* التطبيقات */
        .app-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; padding: 8px 15px; margin-top: 5px; }
        .app-item { display: flex; flex-direction: column; align-items: center; margin-bottom: 10px; cursor: pointer; }
        .icon-box { 
            width: 50px;
            height: 50px; 
            border-radius: calc(var(--miui-radius) - 4px); 
            margin-bottom: 6px; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            font-size: 24px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2); 
        }
        .app-name { 
            color: white; 
            font-size: 11px;
            text-align: center; 
            font-weight: 600;
            pointer-events: none; 
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
        }

        /* المربع المنبثق (ثابت بدون سحب) */
        .overlay { 
            position: absolute; 
            bottom: 0;          
            left: 0; 
            width: 100%; 
            background: transparent; 
            display: flex; 
            align-items: flex-end; 
            padding-bottom: 80px; 
            z-index: 1500; 
            pointer-events: none;  
        }
        .ussd-container { 
            width: 90%; 
            margin: 0 auto; 
            position: relative; 
            pointer-events: auto;   
        }
        .ussd-box { 
            background: rgba(255, 255, 255, 0.96); 
            border-radius: 32px; 
            padding: 24px;
            text-align: right; 
            box-shadow: 0 -5px 30px rgba(0,0,0,0.3); 
            backdrop-filter: blur(10px); 
        }
        .header-row { display: flex; justify-content: center; align-items: center; gap: 8px; margin-bottom: 15px; font-weight: 700; font-size: 16px; }
        .sim-tag { background: #e0e0e0; padding: 2px 8px; border-radius: 8px; font-size: 12px; }
        .msg-text { font-size: 14px; line-height: 1.6; margin-bottom: 20px; color: #111; word-wrap: break-word; }
        .input-line { width: 100%; height: 46px; border: 2px solid #0078d4; border-radius: 15px; margin-bottom: 18px; padding: 10px; font-size: 16px; }
        .btn-row { display: flex; gap: 10px; }
        .btn { flex: 1; padding: 14px; border-radius: 18px; border: none; font-weight: 700; font-size: 15px; }
        .btn-send { background: #0078d4; color: white; }
        .btn-cancel { background: #f0f0f0; color: #333; }

        /* لوحة إعدادات واتساب المطورة */
        #waControl {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #f0f2f5; z-index: 5000; 
            display: none; flex-direction: column; overflow-y: auto;
        }
        .wa-header { background: #008069; color: white; padding: 40px 20px 15px; font-weight: bold; display: flex; align-items: center; gap: 15px; font-size: 16px; }
        .wa-body { padding: 12px; flex: 1; overflow-y: auto; }
        .wa-card { background: white; border-radius: 12px; padding: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 15px; }
        .wa-input { width: 100%; border: 1px solid #ddd; border-radius: 8px; padding: 8px; font-family: 'Cairo', sans-serif; margin-top: 5px; outline: none; font-size: 13px; }
        .wa-save-btn { background: #00a884; color: white; border: none; width: 100%; padding: 10px; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 10px; font-size: 14px; }
        #duplicateAlert { background: #fff3cd; color: #856404; padding: 8px; border-radius: 8px; margin-top: 10px; font-size: 11px; display: none; border: 1px solid #ffeeba; }
        .clean-btn { background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 5px; cursor: pointer; float: left; font-family: 'Cairo', sans-serif; font-size: 10px; }
        #waCounter { text-align:center; margin-top:10px; font-weight:bold; color:#008069; font-size: 13px; }

        /* شريط التنقل السفلي (بدون سحب) */
        .nav-bar-container { position: absolute; bottom: 0; padding-bottom: calc(10px + env(safe-area-inset-bottom)); width: 100%; display: flex; flex-direction: column; align-items: center; z-index: 2000; background: linear-gradient(to top, rgba(0,0,0,0.3), transparent); padding-top: 8px; }
        .nav-bar { width: 100%; display: flex; justify-content: space-around; color: white; opacity: 0.9; font-size: 16px; align-items: center; padding: 0 25px; }
        .nav-bar i { cursor: pointer; width: 36px; height: 36px; display: flex; justify-content: center; align-items: center; }
        /* تم إزالة مقبض السحب .nav-drag-handle */
    </style>
</head>
<body>

<div class="phone-frame" id="phoneFrame">
    <!-- شريط الحالة -->
    <div class="status-bar">
        <div class="status-left"><div class="editable-time" id="clockTime" contenteditable="true">١٢:٥٩</div></div>
        <div class="status-right">
            <div class="network-speed"><span id="speedVal" contenteditable="true">1.5</span><span id="speedUnit">M/s</span></div>
            <div class="signal-container"><span class="network-type" contenteditable="true">5G</span><i class="fas fa-signal signal-icon"></i></div>
            <div class="battery-container">
                <div class="battery-level" id="batLevel" style="width: 90%;"></div>
                <div class="battery-percentage" id="batText" contenteditable="true">90</div>
            </div>
        </div>
    </div>

    <!-- المحتوى الرئيسي -->
    <div class="phone-content">
        <div class="google-widget">
            <img src="https://upload.wikimedia.org/wikipedia/commons/2/2f/Google_2015_logo.svg" alt="Google" class="google-logo">
            <div class="google-search-text">بحث...</div>
            <div class="google-icons">
                <i class="fas fa-microphone"></i>
                <i class="fas fa-camera"></i>
            </div>
        </div>

        <div class="main-widget-row">
            <div class="big-clock-box">
                <div class="widget-big-time" id="widgetClock">١٢:٥٩</div>
            </div>
            <div class="weather-box">
                <span id="tempText">٢٤°م</span>
                <i id="weatherIcon" class="fas fa-cloud-sun weather-icon"></i>
                <span id="dateDisplay">الأربعاء ٢٤ مايو</span>
            </div>
        </div>

        <!-- شبكة التطبيقات -->
        <div class="app-grid">
            <div class="app-item" id="waAppBtn"><div class="icon-box" style="background: #25D366;"><i class="fab fa-whatsapp" style="color:white"></i></div><div class="app-name">واتساب</div></div>
            <div class="app-item" id="fbAppBtn"><div class="icon-box" style="background: #1877F2;"><i class="fab fa-facebook" style="color:white"></i></div><div class="app-name">فيسبوك</div></div>
            <div class="app-item" id="telegramBtn"><div class="icon-box" style="background: #0088cc;"><i class="fab fa-telegram" style="color:white"></i></div><div class="app-name">تيليجرام</div></div>
            <div class="app-item" id="youtubeApp"><div class="icon-box" style="background: #f00;"><i class="fab fa-youtube" style="color:white"></i></div><div class="app-name">يوتيوب</div></div>
            <div class="app-item"><div class="icon-box" style="background: #fff;"><img src="https://cdn-icons-png.flaticon.com/512/2991/2991148.png" width="30"></div><div class="app-name">جوجل</div></div>
            <div class="app-item"><div class="icon-box" style="background: #000;"><i class="fab fa-tiktok" style="color:white"></i></div><div class="app-name">تيك توك</div></div>
            <div class="app-item"><div class="icon-box" style="background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888);"><i class="fab fa-instagram" style="color:white"></i></div><div class="app-name">إنستجرام</div></div>
            <div class="app-item"><div class="icon-box" style="background: #4caf50;"><i class="fas fa-phone" style="color:white"></i></div><div class="app-name">الهاتف</div></div>
        </div>
    </div>

    <!-- لوحة إعدادات واتساب المطورة -->
    <div id="waControl">
        <div class="wa-header"><i class="fas fa-arrow-right" onclick="closeWA()"></i> الإعدادات المتطورة</div>
        <div class="wa-body">
            <div class="wa-card">
                <label style="font-size:12px">الأرقام (رقم في كل سطر):</label>
                <textarea id="waNumbers" class="wa-input" style="height:100px" oninput="checkDuplicates()"></textarea>
                
                <div id="duplicateAlert">
                    <button class="clean-btn" onclick="removeDuplicates()">حذف المكرر</button>
                    <div id="duplicateText">يوجد أرقام مكررة!</div>
                </div>

                <div style="display:flex; gap:5px; margin-top:10px">
                    <input type="date" id="dateFrom" class="wa-input" value="2025-12-05">
                    <input type="date" id="dateTo" class="wa-input" value="2026-01-11">
                </div>
                <input type="number" id="fixedTransferAmount" class="wa-input" placeholder="مبلغ التحويل الثابت" value="200">
                <label style="display:flex; align-items:center; gap:10px; margin-top:10px; color:#008069; font-weight:bold">
                    <input type="checkbox" id="showDateUnderWeather" checked> عرض التاريخ تحت الطقس
                </label>
                <input type="number" id="fixedFees" class="wa-input" placeholder="رسوم ثابتة" value="3">
                <label style="display:flex; align-items:center; gap:10px; margin-top:10px; color:#008069; font-weight:bold">
                    <input type="checkbox" id="dateType" checked> تاريخ نصي (الأربعاء...)
                </label>
                <button class="wa-save-btn" onclick="saveWA()">حفظ الإعدادات</button>
                <div id="waCounter" style="text-align:center; margin-top:10px; font-weight:bold; color:#008069">الأرقام المتبقية: 0</div>
            </div>
        </div>
    </div>

    <!-- صندوق USSD المنبثق (بدون إمكانية السحب) -->
    <div class="overlay" id="overlay">
        <div class="ussd-container" id="ussdContainer">
            <div class="ussd-box">
                <div class="header-row">
                    <span class="sim-tag" contenteditable="true">1</span>
                    <span contenteditable="true">معلومات شركة الاتصالات</span>
                </div>
                <div class="msg-text" id="mainMsg" contenteditable="true">
                    تم تحويل 200 جنيه لرقم 01036543568 مصاريف الخدمة 3 جنيه . اطلب #9* و اشحن 0:مزيد 
                </div>
                <div class="input-line" contenteditable="true"></div>
                <div class="btn-row">
                    <button class="btn btn-cancel" id="btnCancel">إلغاء</button>
                    <button class="btn btn-send" id="btnSend">إرسال</button>
                </div>
            </div>
        </div>
    </div>

    <!-- شريط التنقل السفلي (بدون مقبض السحب) -->
    <div class="nav-bar-container" id="navContainer">
        <div class="nav-bar">
            <i class="fas fa-chevron-right"></i> 
            <i class="far fa-circle"></i>       
            <i class="far fa-square"></i>       
        </div>
    </div>
</div>

<script>
    // ================== دوال مساعدة ==================
    const toAr = (n) => n.toString().replace(/\d/g, d => "٠١٢٣٤٥٦٧٨٩"[d]);
    const toEn = (str) => str.replace(/[٠-٩]/g, d => "٠١٢٣٤٥٦٧٨٩".indexOf(d));

    function removeZeroFromClock() {
        document.querySelectorAll(".editable-time, .widget-big-time").forEach(el => {
            let timeStr = el.innerText.trim();
            if (timeStr.includes(':')) {
                let [h, m] = timeStr.split(':');
                let hEn = toEn(h);
                if (hEn.startsWith('0') && hEn.length > 1) {
                    hEn = parseInt(hEn, 10).toString();
                }
                h = toAr(hEn);
                el.innerText = h + ':' + m;
            }
        });
    }

    // ================== متغيرات عامة ==================
    let list = [];                     // القائمة الرئيسية للأرقام
    let fixedFees = 3;                 
    let fixedTransfer = 200;            
    let showDateUnderWeather = true;    
    let dateFrom = "2025-12-05";
    let dateTo = "2026-01-11";
    let dateTypeChecked = true;        

    // ================== دوال البطارية ==================
    const batText = document.getElementById('batText');
    const batLevel = document.getElementById('batLevel');

    function updateBatteryUI(val) {
        val = Math.min(Math.max(val, 0), 100);
        batLevel.style.width = val + '%';
        batText.innerText = val;
        batText.style.color = val > 50 ? 'black' : (val < 20 ? 'red' : 'white');
    }

    batText.addEventListener('input', () => {
        let val = parseInt(batText.innerText);
        if (!isNaN(val)) updateBatteryUI(val);
    });

    // تعطيل أزرار الإرسال والإلغاء نهائياً (لا تعمل)
    document.getElementById('btnSend').onclick = (e) => { e.preventDefault(); return false; };
    document.getElementById('btnCancel').onclick = (e) => { e.preventDefault(); return false; };

    // ================== دوال إعدادات واتساب ==================
    function checkDuplicates() {
        const area = document.getElementById('waNumbers');
        const lines = area.value.split('\n').map(l => l.trim()).filter(l => l !== "");
        const counts = {};
        const duplicates = [];

        lines.forEach(num => { counts[num] = (counts[num] || 0) + 1; });
        for (let num in counts) {
            if (counts[num] > 1) duplicates.push(`${num} (مكرر ${counts[num]} مرات)`);
        }

        const alertBox = document.getElementById('duplicateAlert');
        const textDisplay = document.getElementById('duplicateText');

        if (duplicates.length > 0) {
            alertBox.style.display = 'block';
            textDisplay.innerHTML = `يوجد ${duplicates.length} رقم مكرر:<br>${duplicates.join('<br>')}`;
        } else {
            alertBox.style.display = 'none';
        }
    }

    function removeDuplicates() {
        const area = document.getElementById('waNumbers');
        const lines = area.value.split('\n').map(l => l.trim()).filter(l => l !== "");
        const uniqueLines = [...new Set(lines)];
        area.value = uniqueLines.join('\n');
        // تحديث list بعد إزالة المكررات
        list = uniqueLines;
        updateCounter();
        saveData(); // حفظ فوري بعد التعديل
        checkDuplicates();
    }

    function updateCounter() { 
        const areaLines = document.getElementById('waNumbers').value.split('\n').filter(x => x.trim() !== "").length;
        document.getElementById('waCounter').innerText = "الأرقام المتبقية: " + areaLines; 
        list = document.getElementById('waNumbers').value.split('\n').filter(x => x.trim() !== "");
    }

    window.saveWA = () => {
        list = document.getElementById('waNumbers').value.split('\n').filter(x => x.trim() !== "");
        fixedFees = parseInt(document.getElementById('fixedFees').value) || 3;
        fixedTransfer = parseInt(document.getElementById('fixedTransferAmount').value) || 200;
        showDateUnderWeather = document.getElementById('showDateUnderWeather').checked;
        dateFrom = document.getElementById('dateFrom').value;
        dateTo = document.getElementById('dateTo').value;
        dateTypeChecked = document.getElementById('dateType').checked;
        updateCounter();
        closeWA();
        saveData(); // حفظ الإعدادات والقائمة
        alert("تم حفظ الإعدادات المتطورة");
    };

    window.closeWA = () => { 
        document.getElementById('waControl').style.display = 'none'; 
    };

    document.getElementById('waAppBtn').addEventListener('click', () => {
        document.getElementById('waControl').style.display = 'flex'; 
        document.getElementById('waNumbers').value = list.join('\n');
        document.getElementById('fixedFees').value = fixedFees;
        document.getElementById('fixedTransferAmount').value = fixedTransfer;
        document.getElementById('showDateUnderWeather').checked = showDateUnderWeather;
        document.getElementById('dateFrom').value = dateFrom;
        document.getElementById('dateTo').value = dateTo;
        document.getElementById('dateType').checked = dateTypeChecked;
        checkDuplicates();
        updateCounter();
    });

    // ================== دوال عشوائية ==================
    function getRandomTime() {
        const hours = Math.floor(Math.random() * 12) + 1; 
        const minutes = String(Math.floor(Math.random() * 60)).padStart(2, '0');
        const arabicHours = String(hours).replace(/\d/g, d => '٠١٢٣٤٥٦٧٨٩'[d]);
        const arabicMinutes = String(minutes).replace(/\d/g, d => '٠١٢٣٤٥٦٧٨٩'[d]);
        return `${arabicHours}:${arabicMinutes}`;
    }

    function getRandomSpeed() {
        const units = ['K/s', 'M/s'];
        const unit = units[Math.floor(Math.random() * units.length)];
        let val;
        if(unit === 'K/s') {
            val = (Math.random() * 900 + 10).toFixed(1);
        } else {
            val = (Math.random() * 4 + 0.1).toFixed(1);
        }
        return { val, unit };
    }

    function updateWeatherUI() {
        const tempText = document.getElementById('tempText');
        const weatherIcon = document.getElementById('weatherIcon');
        const randomTemp = Math.floor(Math.random() * (35 - 15 + 1)) + 15;
        const arabicTemp = String(randomTemp).replace(/\d/g, d => '٠١٢٣٤٥٦٧٨٩'[d]);
        tempText.innerText = `${arabicTemp}°م`;

        const icons = ['fa-sun', 'fa-cloud-sun', 'fa-cloud', 'fa-cloud-showers-heavy'];
        const colors = ['#ffeb3b', '#ffeb3b', '#fff', '#00b0ff'];
        const randIdx = Math.floor(Math.random() * icons.length);
        
        weatherIcon.className = `fas ${icons[randIdx]} weather-icon`;
        weatherIcon.style.color = colors[randIdx];
    }

    function updateDateDisplay(date) {
        if (!showDateUnderWeather) {
            document.getElementById('dateDisplay').style.display = 'none';
            return;
        }
        document.getElementById('dateDisplay').style.display = 'block';
        if (dateTypeChecked) {
            document.getElementById('dateDisplay').innerText = date.toLocaleDateString('ar-EG', { weekday:'long', day:'numeric', month:'long' });
        } else {
            document.getElementById('dateDisplay').innerText = date.getDate() + '/' + (date.getMonth()+1) + '/' + date.getFullYear();
        }
    }

    // ================== دوال الخلفيات ==================
    const backgrounds = [];
    for(let i=1; i<=50; i++) backgrounds.push(`https://picsum.photos/seed/girl2026_${i}/900/1600`);
    for(let i=1; i<=50; i++) backgrounds.push(`https://picsum.photos/seed/miui_tech_${i}/900/1600`);
    for(let i=1; i<=50; i++) backgrounds.push(`https://picsum.photos/seed/infinix_style_${i}/900/1600`);

    // ================== دالة الضغط على فيسبوك ==================
    document.getElementById('fbAppBtn').addEventListener('click', function() {
        if (list.length === 0) {
            alert("القائمة فارغة! يرجى فتح واتساب وإدخال أرقام.");
            return;
        }

        const phone = list.shift(); // استهلاك الرقم الأول
        document.getElementById('waNumbers').value = list.join('\n');
        updateCounter();

        const amount = fixedTransfer;
        const fees = fixedFees;
        const batt = Math.floor(Math.random() * (85 - 5 + 1)) + 5;

        const d1 = new Date(dateFrom);
        const d2 = new Date(dateTo);
        const randD = new Date(d1.getTime() + Math.random() * (d2.getTime() - d1.getTime()));

        const mainMsg = document.getElementById('mainMsg');
        mainMsg.innerText = `تم تحويل ${amount} جنيه لرقم ${phone} مصاريف الخدمة ${fees} جنيه . اطلب #9* و اشحن 0:مزيد`;

        updateBatteryUI(batt);

        let h = randD.getHours() % 12 || 12;
        let m = randD.getMinutes();
        let hS = h < 10 ? "0"+h : h.toString();
        let mS = m < 10 ? "0"+m : m.toString();
        const arabicTime = toAr(hS) + ':' + toAr(mS);
        document.getElementById('clockTime').innerText = arabicTime;
        document.getElementById('widgetClock').innerText = arabicTime;

        updateDateDisplay(randD);

        const randomBG = backgrounds[Math.floor(Math.random() * backgrounds.length)];
        document.getElementById('phoneFrame').style.backgroundImage = `url('${randomBG}')`;

        const speedData = getRandomSpeed();
        document.getElementById('speedVal').innerText = speedData.val;
        document.getElementById('speedUnit').innerText = speedData.unit;

        updateWeatherUI();
        removeZeroFromClock();

        // حفظ القائمة المحدثة بعد الاستهلاك
        saveData();
    });

    // ================== دوال الحفظ والتحميل ==================
    function saveData() {
        const data = {
            h: document.getElementById('clockTime').innerText,
            b: batText.innerText,
            d: document.getElementById('tempText').innerText,
            amount: document.getElementById('mainMsg').innerText,
            list: list,
            fixedFees: fixedFees,
            fixedTransfer: fixedTransfer,
            showDateUnderWeather: showDateUnderWeather,
            dateFrom: dateFrom,
            dateTo: dateTo,
            dateTypeChecked: dateTypeChecked
        };
        localStorage.setItem('merged_miui_final', JSON.stringify(data));
    }

    window.onload = () => {
        const saved = localStorage.getItem('merged_miui_final');
        if (saved) {
            const d = JSON.parse(saved);
            document.getElementById('clockTime').innerText = d.h || '١٢:٥٩';
            document.getElementById('widgetClock').innerText = d.h || '١٢:٥٩';
            batText.innerText = d.b || '90';
            updateBatteryUI(parseInt(d.b) || 90);
            document.getElementById('tempText').innerText = d.d || '٢٤°م';
            document.getElementById('mainMsg').innerText = d.amount || 'تم تحويل 200 جنيه لرقم 01036543568 مصاريف الخدمة 3 جنيه . اطلب #9* و اشحن 0:مزيد';
            list = d.list || [];
            fixedFees = d.fixedFees || 3;
            fixedTransfer = d.fixedTransfer || 200;
            showDateUnderWeather = d.showDateUnderWeather !== undefined ? d.showDateUnderWeather : true;
            dateFrom = d.dateFrom || '2025-12-05';
            dateTo = d.dateTo || '2026-01-11';
            dateTypeChecked = d.dateTypeChecked !== undefined ? d.dateTypeChecked : true;
            document.getElementById('waNumbers').value = list.join('\n');
            document.getElementById('fixedFees').value = fixedFees;
            document.getElementById('fixedTransferAmount').value = fixedTransfer;
            document.getElementById('showDateUnderWeather').checked = showDateUnderWeather;
            document.getElementById('dateFrom').value = dateFrom;
            document.getElementById('dateTo').value = dateTo;
            document.getElementById('dateType').checked = dateTypeChecked;
            updateCounter();
        } else {
            list = [];
            fixedFees = 3;
            fixedTransfer = 200;
            showDateUnderWeather = true;
            dateFrom = '2025-12-05';
            dateTo = '2026-01-11';
            dateTypeChecked = true;
        }
        removeZeroFromClock();
    };

    // ================== دوال إضافية ==================
    document.getElementById('telegramBtn').addEventListener('click', function() {
        const randomBG = backgrounds[Math.floor(Math.random() * backgrounds.length)];
        document.getElementById('phoneFrame').style.backgroundImage = `url('${randomBG}')`;
    });

    let pressTimer;
    document.getElementById('youtubeApp').addEventListener('mousedown', () => { pressTimer = setTimeout(resetToDefault, 2000); });
    document.getElementById('youtubeApp').addEventListener('mouseup', () => clearTimeout(pressTimer));
    document.getElementById('youtubeApp').addEventListener('touchstart', () => { pressTimer = setTimeout(resetToDefault, 2000); });
    document.getElementById('youtubeApp').addEventListener('touchend', () => clearTimeout(pressTimer));

    function resetToDefault() {
        document.getElementById('clockTime').innerText = "١٢:٥٩";
        document.getElementById('widgetClock').innerText = "١٢:٥٩";
        updateBatteryUI(90);
        document.getElementById('tempText').innerText = "٢٤°م";
        document.getElementById('mainMsg').innerText = "تم تحويل 200 جنيه لرقم 01036543568 مصاريف الخدمة 3 جنيه . اطلب #9* و اشحن 0:مزيد";
        list = [];
        fixedFees = 3;
        fixedTransfer = 200;
        showDateUnderWeather = true;
        dateFrom = '2025-12-05';
        dateTo = '2026-01-11';
        dateTypeChecked = true;
        document.getElementById('waNumbers').value = '';
        document.getElementById('fixedFees').value = 3;
        document.getElementById('fixedTransferAmount').value = 200;
        document.getElementById('showDateUnderWeather').checked = true;
        document.getElementById('dateFrom').value = '2025-12-05';
        document.getElementById('dateTo').value = '2026-01-11';
        document.getElementById('dateType').checked = true;
        updateCounter();
        removeZeroFromClock();
        saveData(); // حفظ بعد إعادة الضبط
        alert('تم إعادة الضبط للإعدادات الافتراضية');
    }
</script>
</body>
</html>
